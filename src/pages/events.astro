---
import Base from "../layouts/Base.astro";
import { getCollection, type CollectionEntry } from "astro:content";

// 定义类型别名，便于复用
type EventEntry = CollectionEntry<"events">;

const events = await getCollection("events");

// 更稳：把字符串日期转为时间戳再排序
const sorted: EventEntry[] = events
  .slice()
  .sort(
    (a: EventEntry, b: EventEntry) =>
      new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  );

// 小工具：格式化日期
const formatDate = (iso: string) => new Date(iso).toLocaleString();
---
<Base title="Events — Robotics Society">
  <section class="mx-auto max-w-6xl px-4 py-12">
    <h2 class="text-2xl font-semibold">Upcoming Events</h2>
    <div class="grid md:grid-cols-2 gap-6 mt-6">
      {sorted.map((entry: EventEntry) => {
        const { data, slug } = entry;
        return (
          <article class="rounded-2xl shadow p-6 bg-white/70 border border-slate-200">
            <div class="text-sm text-slate-500">{formatDate(data.date)}</div>
            <h3 class="font-semibold mt-1">{data.title}</h3>
            {data.location && <p class="text-slate-600 mt-1">{data.location}</p>}
            {data.signup_url && (
              <a
                class="mt-3 inline-block rounded-lg px-3 py-2 text-sm bg-indigo-600 text-white"
                href={data.signup_url}
              >RSVP</a>
            )}
          </article>
        );
      })}
    </div>
  </section>
</Base>
